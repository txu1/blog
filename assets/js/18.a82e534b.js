(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{630:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"服务端开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端开发"}},[t._v("#")]),t._v(" 服务端开发")]),t._v(" "),a("img",{attrs:{id:"topImg",src:"/blog/images/IMG_9022.JPG"}}),t._v(" "),a("h2",{attrs:{id:"nodejs概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs概述"}},[t._v("#")]),t._v(" Nodejs概述")]),t._v(" "),a("p",[t._v("Nodejs作为服务端宿主环境不提供DOM和BOM，但与浏览器有着相同的运行机制和原理因为是基于Chrome浏览器V8引擎，打破了JS只能在浏览器中运行的局面，前后端编程环境统一，大大降低前后度端转换所需要的成本，令前端开发者能够以相对较小的成本跨界服务端。")]),t._v(" "),a("h2",{attrs:{id:"nodejs应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs应用"}},[t._v("#")]),t._v(" Nodejs应用")]),t._v(" "),a("ul",[a("li",[t._v("命令行工具")]),t._v(" "),a("li",[t._v("全栈式开发")]),t._v(" "),a("li",[t._v("中间层跨域")]),t._v(" "),a("li",[t._v("伪接口测试")]),t._v(" "),a("li",[t._v("服务端渲染")])]),t._v(" "),a("h2",{attrs:{id:"nodejs特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs特点"}},[t._v("#")]),t._v(" Nodejs特点")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("单线程")]),t._v("：多线程之间的切换开销较大，经常面临死锁、状态同步等问题")]),t._v(" "),a("li",[a("strong",[t._v("异步编程")]),t._v("：不会因计时器、网络、文件、数据库等系统操作阻塞同步代码，导致CPU得不到更好利用")])]),t._v(" "),a("h2",{attrs:{id:"异步编程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步编程"}},[t._v("#")]),t._v(" 异步编程")]),t._v(" "),a("p",[a("strong",[t._v("基于函数式编程，Node所有API都支持回调函数，异步编程依托于回调来实现")])]),t._v(" "),a("p",[t._v("异步编程的难点：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("异常处理")]),t._v("：如果异步回调函数报错，try/catch是无法捕捉到的，Node在处理异常上形成了一种约定，将异常作为回调函数的第一个实参")]),t._v(" "),a("li",[a("strong",[t._v("服务雪崩")]),t._v("：高并发场景下，相同的请求会影响服务器性能")]),t._v(" "),a("li",[a("strong",[t._v("异步协同")]),t._v("：如果并行的异步函数有依赖关系，但返回结果不按理想顺序")]),t._v(" "),a("li",[a("strong",[t._v("回调地狱")]),t._v("：如果是串行的异步函数，随着逻辑变复杂，每增加一层异步操作，就会至少多一层回调函数嵌套，如果还考虑到异常处理，代码到了后期非常不易阅读和维护")]),t._v(" "),a("li",[a("strong",[t._v("阻塞线程")]),t._v("：早期JS没有sleep()沉睡线程的功能，定时器不能阻塞单线程后续同步代码，在不占用CPU的情况下很难实现")])]),t._v(" "),a("p",[t._v("解决方案：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("工具函数")])]),t._v(" "),a("li",[a("strong",[t._v("发布订阅模式")])]),t._v(" "),a("li",[a("strong",[t._v("async/await")])])]),t._v(" "),a("h2",{attrs:{id:"commonjs模块化规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commonjs模块化规范"}},[t._v("#")]),t._v(" CommonJS模块化规范")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("module.exports = {}")])]),t._v(" "),a("li",[a("strong",[t._v("exports = module.exports")])]),t._v(" "),a("li",[a("strong",[t._v("require()是同步加载的，将引入模块的同步异步任务执行完才执行下一行，返回的是module.exports")])]),t._v(" "),a("li",[a("strong",[t._v("require()在同一个文件多次引入同一个模块，会使用系统缓存直接返回加载好的第一次引入的结果")])]),t._v(" "),a("li",[a("strong",[t._v("require('xxx')是加载内置或第三方模块，require('./xxx')是加载自定义模块")])]),t._v(" "),a("li",[a("strong",[t._v("CommonJS模块导出的是浅拷贝，ES6模块导出的是只读引用")])]),t._v(" "),a("li",[a("strong",[t._v("为了在Webpack中使用tree shaking必须使用ES6模块")])])]),t._v(" "),a("h2",{attrs:{id:"模块编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块编译"}},[t._v("#")]),t._v(" 模块编译")]),t._v(" "),a("p",[t._v("本质上每个js文件都是一个新的Module类实例module，最终会被编译进一个函数内，实参有exports、require、module、__filename、__dirname，所以每个js文件才能访问这些变量，并且每个文件的module.exports都是独立的")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自己写的Nodejs代码会被包装在这")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("__filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"fs模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fs模块"}},[t._v("#")]),t._v(" fs模块")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("readdirSync('./')")]),t._v("：同步地读取当前文件目录，返回一个包含目录下所有文件名的数组")]),t._v(" "),a("li",[a("strong",[t._v("readdir('./',(err,data)=>console.log(data))")]),t._v("：异步地读取当前文件目录，并打印出包含该目录下所有文件名的数组，没返回值")]),t._v(" "),a("li",[a("strong",[t._v("readFileSync('./index.js','utf8')")]),t._v("：同步地读取当前目录的index.js文件，返回utf8编码格式内容的字符串；如果是图片或者音视频资源，用utf8编码格式会乱码，默认使用buffer文件流格式")]),t._v(" "),a("li",[a("strong",[t._v("readFile('./index.js','utf8',(err,data)=>console.log(data))")]),t._v("：异步地读取当前目录的index.js文件，并打印出该文件中的内容，没返回值")]),t._v(" "),a("li",[a("strong",[t._v("writeFileSync('./index.js','hello','utf8')")]),t._v("：向当前目录的index.js文件覆盖式地写入内容'hello'，如果文件不存在，创建该文件再写'hello'")]),t._v(" "),a("li",[a("strong",[t._v("writeFile('./index.js','hello','utf8',err=>console.log(err))")]),t._v("：异步地向index.js写入内容")]),t._v(" "),a("li",[a("strong",[t._v("appendFileSync('./index.js','hello','utf8')")]),t._v("：同步地给index.js文件尾部加入内容")]),t._v(" "),a("li",[a("strong",[t._v("appendFile('./index.js','hello','utf8',err=>console.log(err))")]),t._v("：异步地给index.js文件尾部加入内容")]),t._v(" "),a("li",[a("strong",[t._v("copyFile('./index.js','./copy.js',err=>console.log(err))")]),t._v("：拷贝出来的新文件如果和已有文件重名，会覆盖掉已有文件")]),t._v(" "),a("li",[a("strong",[t._v("unlink('./img/1.png',err=>console.log(err))")]),t._v("：删除文件1.png")]),t._v(" "),a("li",[a("strong",[t._v("mkdir('./img',err=>console.log(err))")]),t._v("：创建目录img")]),t._v(" "),a("li",[a("strong",[t._v("rmdir('./img',err=>console.log(err))")]),t._v("：删除目录img，且一定要保证目录里没有文件和子目录")])]),t._v(" "),a("h2",{attrs:{id:"post接口-打印日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#post接口-打印日志"}},[t._v("#")]),t._v(" POST接口+打印日志")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Router "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-router'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bodyParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-bodyparser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" api "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// axios.post(\"localhost:3000\", {event:'pageview',url:'localhost:8080',th_app_id:'web'}).then(res => console.log(res)).catch(err => console.log(err))")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// localhost:3000?event=pageview&url=localhost:8080&th_app_id=web")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// axios.post(\"localhost:3000\", {event:'pageloadDuration',url:'localhost:8080',th_app_id:'web',duration:500}).then(res => console.log(res)).catch(err => console.log(err))")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// localhost:3000?event=pageloadDuration&url=localhost:8080&th_app_id=web&duration=500")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// axios.post(\"localhost:3000\", {event:'networkRequestMonitor',url:'localhost:8080',th_app_id:'web',duration:500,httpCode:200}).then(res => console.log(res)).catch(err => console.log(err))")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// localhost:3000?event=networkRequestMonitor&url=localhost:8080&th_app_id=web&duration=500&httpCode=200")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// axios.post(\"localhost:3000\", {event:'clickElement',elementId:'cart',th_app_id:'web',productId:'AP-GP-CL'}).then(res => console.log(res)).catch(err => console.log(err))")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// localhost:3000?event=clickElement&elementId=cart&th_app_id=web&productId=AP-GP-CL")]),t._v("\n\napp\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyParser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body\n  \n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" content "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\n\\n'")]),t._v("\n\n    fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./record.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" 事件 检测成功")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'server is running at http://localhost:'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"网络安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络安全"}},[t._v("#")]),t._v(" 网络安全")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("XSS（Cross Site Scripting）跨站脚本攻击")]),t._v(" "),a("ul",[a("li",[t._v("原理：页面渲染的数据中包含可运行的脚本，攻击类型有反射型（url参数直接注入）和存储型（存储到DB后读取时注入），可以注入HTML元素和JS代码")]),t._v(" "),a("li",[t._v("危害：利用虚假输入表单骗取用户个人信息；利用脚本窃取用户的Cookie值，被害者在不知情的情况下，帮助攻击者发送恶意请求；显示伪造的文章或图片")]),t._v(" "),a("li",[t._v("防御：\n"),a("ul",[a("li",[t._v("建立CSP（Content Security Policy）提供资源的网址白名单")]),t._v(" "),a("li",[t._v("设置表单输入的格式，前端服务端过滤危险标签，转义危险字符")])])])])]),t._v(" "),a("li",[a("strong",[t._v("CSRF（Cross Site Request Forgery）跨站请求伪造")]),t._v(" "),a("ul",[a("li",[t._v("原理：在第三方网站向本网站发起请求，只要用户访问了第三方网站的前端页面，第三方网站就可以在用户完全不知道的情况下，带着本网站的用户登录态（cookie）向本网站发起请求，可以和XSS结合使用变成XSS蠕虫攻击")]),t._v(" "),a("li",[t._v("危害：盗用用户身份来转账、发帖、完成业务请求")]),t._v(" "),a("li",[t._v("防御：前端服务端进行Anti-CSRF-Token验证")])])]),t._v(" "),a("li",[a("strong",[t._v("DDOS（Distributed Denial of Service）分布式拒绝服务")]),t._v(" "),a("ul",[a("li",[t._v("原理：通过大量非正常的请求，耗尽服务器的资源，使得服务器不能正常地运行，不能为合法用户服务")]),t._v(" "),a("li",[t._v("危害：攻击流量超过服务网络设备的极限或带宽的最大负荷，网站服务将瘫痪导致无法正常运作")]),t._v(" "),a("li",[t._v("防御：\n"),a("ul",[a("li",[t._v("验证码")]),t._v(" "),a("li",[t._v("限制请求频率")]),t._v(" "),a("li",[t._v("扩容加带宽")]),t._v(" "),a("li",[t._v("分布式服务")]),t._v(" "),a("li",[t._v("云防御服务")])])])])]),t._v(" "),a("li",[a("strong",[t._v("HTTP劫持")]),t._v(" "),a("ul",[a("li",[t._v("原理：运营商利用http明文传输的特性，篡改了服务端到浏览器的网页内容")]),t._v(" "),a("li",[t._v("危害：给正常网站加入额外的广告")]),t._v(" "),a("li",[t._v("防御：使用HTTPS协议")])])]),t._v(" "),a("li",[a("strong",[t._v("点击劫持")]),t._v(" "),a("ul",[a("li",[t._v("原理：点击劫持是一种视觉欺骗的攻击手段。攻击者将需要攻击的网站通过 iframe 嵌套的方式嵌入自己的网页中，并将 iframe 设置为透明，在页面中透出一个按钮诱导用户点击")]),t._v(" "),a("li",[t._v("危害：骗取用户点击操作")]),t._v(" "),a("li",[t._v("防御：给HTTP响应头设置X-FRAME-OPTIONS：DENY来禁止本页面通过iframe展示")])])]),t._v(" "),a("li",[a("strong",[t._v("中间人攻击")]),t._v(" "),a("ul",[a("li",[t._v("原理：中间人截取客户端发送给服务器的请求，然后伪装成客户端与服务器进行通信；将服务器返回给客户端的内容发送给客户端，伪装成服务器与客户端进行通信")]),t._v(" "),a("li",[t._v("危害：客户端如果信任中间人的证书，中间人便可以获取客户端和服务器之间通信的所有内容")]),t._v(" "),a("li",[t._v("防御：\n"),a("ul",[a("li",[t._v("客户端不要轻易信任弹出的可疑证书")]),t._v(" "),a("li",[t._v("不在公共Wi-Fi网络上购买或发送敏感数据，因为攻击者能用SSL剥离技术，把HTTPS降级为HTTP")])])])])])]),t._v(" "),a("h2",{attrs:{id:"浏览器对非同源网站的限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器对非同源网站的限制"}},[t._v("#")]),t._v(" 浏览器对非同源网站的限制")]),t._v(" "),a("p",[t._v("同源策略(Same origin Policy): 浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。")]),t._v(" "),a("ul",[a("li",[t._v("非同源网站的Cookie、LocalStorage 和 IndexDB 无法读取")]),t._v(" "),a("li",[t._v("非同源网站的DOM无法获取")]),t._v(" "),a("li",[t._v("向非同源服务器发送的AJAX请求，其响应会被浏览器拒绝")])]),t._v(" "),a("p",[t._v("由于前后端分离的开发模式，哪怕只是前端和后端运行端口不一致，也算非同源，也算跨域，AJAX响应也会被拒绝，但必须要跨域，因为前端必须要拿到后端的数据。")]),t._v(" "),a("h2",{attrs:{id:"跨域的9种方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域的9种方式"}},[t._v("#")]),t._v(" 跨域的9种方式")]),t._v(" "),a("ul",[a("li",[t._v("JSONP（只能发GET请求）")]),t._v(" "),a("li",[t._v("CORS（主流）")]),t._v(" "),a("li",[t._v("Node中间件代理（主流）")]),t._v(" "),a("li",[t._v("Ngix反向代理（没前端什么事）")]),t._v(" "),a("li",[t._v("PostMessage（非主流）")]),t._v(" "),a("li",[t._v("WebSocket（非主流）")]),t._v(" "),a("li",[t._v("window.name+iframe（非主流）")]),t._v(" "),a("li",[t._v("location.hash+iframe（非主流）")]),t._v(" "),a("li",[t._v("document.domain+iframe（非主流）")])]),t._v(" "),a("h2",{attrs:{id:"rest架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest架构"}},[t._v("#")]),t._v(" REST架构")]),t._v(" "),a("p",[t._v("REST（Representational State Transfer）表象层状态转变指的是一组架构约束条件和原则，它由Roy Fielding于2000年论文中提出，它代表着分布式服务的架构风格。如果一个架构符合REST的约束条件和原则，我们就称它为REST架构。")]),t._v(" "),a("p",[t._v("REST六大原则：")]),t._v(" "),a("ul",[a("li",[t._v("客户端-服务端（Client-Server）\n"),a("ul",[a("li",[t._v("前后端关注点分离")]),t._v(" "),a("li",[t._v("服务端专注数据存储，提升了简单性")]),t._v(" "),a("li",[t._v("前端关注数据渲染，提升了可移植性")])])]),t._v(" "),a("li",[t._v("无状态（Stateless）\n"),a("ul",[a("li",[t._v("所有用户会话信息都保存在客户端")]),t._v(" "),a("li",[t._v("客户端每次请求必须包括所有信息")]),t._v(" "),a("li",[t._v("服务端不用保存会话信息，提升了简单性、可靠性、可见性")])])]),t._v(" "),a("li",[t._v("缓存（Cache）\n"),a("ul",[a("li",[t._v("所有服务端响应都要被标为可缓存或不可缓存")]),t._v(" "),a("li",[t._v("减少前后端交互，提升性能")])])]),t._v(" "),a("li",[t._v("统一接口（Uniform Interface）\n"),a("ul",[a("li",[t._v("接口设计尽可能统一通用，提升了简单性、可见性")]),t._v(" "),a("li",[t._v("接口与实现解耦，使前后端可以独立开发迭代")])])]),t._v(" "),a("li",[t._v("分层系统（Layered System）\n"),a("ul",[a("li",[t._v("每层只知道相邻的一层，后面隐藏的就不知道")]),t._v(" "),a("li",[t._v("客户端不知道是和代理还是真实服务器通信")]),t._v(" "),a("li",[t._v("其他层：安全层、负载均衡、缓存层等")])])]),t._v(" "),a("li",[t._v("按需代码（Code-On-Demand）\n"),a("ul",[a("li",[t._v("客户端可以下载运行服务器端传来的代码")]),t._v(" "),a("li",[t._v("通过减少一些功能，简化了客户端")])])])]),t._v(" "),a("p",[t._v("在前后端分离的背景下，RESTful API就是符合REST架构风格的API，用来设计便于理解，容易使用的API的设计规范。一个RESTful API一般包含三方面：")]),t._v(" "),a("ul",[a("li",[t._v("基本的URL，如"),a("strong",[t._v("https://api.github.com/users")])]),t._v(" "),a("li",[t._v("标准的HTTP方法，如GET、POST、PUT、PATCH、DELETE")]),t._v(" "),a("li",[t._v("传输的数据媒体类型，如JSON、XML")])]),t._v(" "),a("p",[t._v("GitHub REST API示例：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("POST /user/repos")]),t._v("（Create a new repository）")]),t._v(" "),a("li",[a("strong",[t._v("DELETE /repos/:owner/:repo")]),t._v("（Delete a repository）")]),t._v(" "),a("li",[a("strong",[t._v("PATCH /repos/:owner/:repo")]),t._v("（Edit a repository）")]),t._v(" "),a("li",[a("strong",[t._v("PUT /repos/:owner/:repo/topics")]),t._v("（Replace all topics for a repository）")]),t._v(" "),a("li",[a("strong",[t._v("POST /repos/:owner/:repo/transfer")]),t._v("（Transfer a repository）")]),t._v(" "),a("li",[a("strong",[t._v("GET /user/repos")]),t._v("（List your repositories）")]),t._v(" "),a("li",[a("strong",[t._v("GET /users/:username/repos")]),t._v("（List user repositories）")]),t._v(" "),a("li",[a("strong",[t._v("GET /orgs/:org/repos")]),t._v("（List organization repositories）")])]),t._v(" "),a("h2",{attrs:{id:"api设计最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api设计最佳实践"}},[t._v("#")]),t._v(" API设计最佳实践")]),t._v(" "),a("p",[a("strong",[t._v("路由")])]),t._v(" "),a("ul",[a("li",[t._v("不同的URL展示不同的页面")]),t._v(" "),a("li",[t._v("单页面应用URL切换时页面无刷新")])]),t._v(" "),a("p",[a("strong",[t._v("请求规范")])]),t._v(" "),a("ul",[a("li",[t._v("URL使用名词，尽量使用复数，如/users")]),t._v(" "),a("li",[t._v("URL使用嵌套表示关联关系，如/users/12/repo/5")]),t._v(" "),a("li",[t._v("使用正确的HTTP方法，如GET/POST/PUT/DELETE")]),t._v(" "),a("li",[t._v("不符合CRUD的情况：POST/action/子资源")]),t._v(" "),a("li",[t._v("不同的HTTP请求应该得到不同的数据")])]),t._v(" "),a("p",[a("strong",[t._v("响应规范")])]),t._v(" "),a("ul",[a("li",[t._v("过滤查询")]),t._v(" "),a("li",[t._v("分页查询")]),t._v(" "),a("li",[t._v("字段过滤")]),t._v(" "),a("li",[t._v("状态码")]),t._v(" "),a("li",[t._v("错误处理")])]),t._v(" "),a("p",[a("strong",[t._v("安全")])]),t._v(" "),a("ul",[a("li",[t._v("HTTPS")]),t._v(" "),a("li",[t._v("鉴权")]),t._v(" "),a("li",[t._v("限流")])]),t._v(" "),a("p",[a("strong",[t._v("开发者友好")])]),t._v(" "),a("ul",[a("li",[t._v("文档")]),t._v(" "),a("li",[t._v("超媒体")])])])}),[],!1,null,null,null);s.default=e.exports}}]);